
---
title: |
  ![](img/ppg.png){width=60%} 
  
  Avaliação da diversidade genética em 15 acessos por meio de marcadores moleculares do tipo SSR (microssatélites) e RAPD
author: "Adriana Gonela, Helio de souza Junior e Pedro Duhatschek"
date: "06-09-2025"
lang: pt
toc: true
code-annotations: "hover"
editor: 
  markdown: 
    wrap: 72
editor_options: 
  chunk_output_type: console
---
\pagebreak
**Disciplina: DAG4497 – Biotecnologia Aplicada ao Melhoramento de
Plantas, ministrada pela Profa. Dra. Adriana Gonela.**

Elaborado por [Helio de Souza Junior](https://github.com/Helioszjr), com
[RStudio](https://posit.co/download/rstudio-desktop) usando
[Rmarkdown](https://rmarkdown.rstudio.com/index.html) e
[Quarto](https://quarto.org/docs/guide/). Código disponível no
[GitHub](https://github.com/Helioszjr).

## Instalar pacotes

```{r, echo=TRUE, eval=FALSE}
options(repos = c(CRAN = "https://cran.r-project.org"))
install.packages(c("readxl", "dplyr", "tidyverse","adegenet", 
"vegan", "cluster", "factoextra", "ape"))
```

## Carregar pacotes

```{r, message=FALSE}
library(readxl)
library(dplyr)
library(tidyverse)
library(adegenet)
library(ape)
library(vegan)        # Para distância de Jaccard
library(cluster)      # Para clustering
library(factoextra)   # Para visualização do dendrograma
```

## 1. Leitura dos dados RAPD

```{r, message=FALSE}
RAPD <- read_excel("C:/Git/EstDocenciaUEM/AULA - PRATICA/RAPD.xlsx", sheet = "RAPD")
```

```{r}
head(RAPD)
```

```{r}
dados1 <- RAPD |> rename(individuo = 1)
```

### 2. Separar identificadores e matriz binária

```{r}
matriz_binaria <- dados1 |> select(-individuo)
nomes <- dados1$individuo
```

### 3. Calcular matriz de distância (Jaccard)

```{r}
dist_jaccard <- vegdist(matriz_binaria, method = "jaccard")
```

### 4. Agrupamento hierárquico (método UPGMA)

```{r}
cluster <- hclust(dist_jaccard, method = "average")
```

### 5. Dendrograma (agrupamento hierárquico)

```{r}
# Mostra similaridade entre indivíduos.
dist_mat <- dist(matriz_binaria)
hc1 <- hclust(dist_mat, method = "ward.D2")
plot(hc1, main = "Dendrograma de similaridade RAPD", xlab = "", sub = "")

```

```{r}
fviz_dend(hc1,
          cex = 0.8,               # Tamanho da fonte
          k = 4,                   # Número de grupos (opcional)
          k_colors = c("#E41A1C", "#377EB8", "#4DAF4A", "#984EA3"),  # Cores para os grupos
          label_cols = "black",
          rect = TRUE,             # Mostrar retângulos nos grupos
          rect_fill = TRUE,
          rect_border = "jco",     # Cor das bordas
          main = "Dendrograma de similaridade RAPD")
```

### 5.1. Dendrograma com rótulos dos indivíduos coloridos

```{r, warning=FALSE}
# Plotagem usando factoextra
fviz_dend(cluster,
          k = 4,  # Número de grupos (ajuste conforme necessário)
          k_colors = c("#E41A1C", "#377EB8", "#4DAF4A", "#984EA3"),  # Cores para os grupos
          label_cols = "black",
          rect = TRUE,
          rect_border = "jco",
          rect_fill = TRUE,
          main = "Dendrograma (Jaccard + UPGMA)",
          cex = 0.8)
```

### 6. Análise de Componentes Principais (PCA)

```{r}
# Padronizar a matriz binária (opcional)
pca <- prcomp(matriz_binaria, center = TRUE, scale. = TRUE)
```


```{r}
# Plotagem usando factoextra
# Plotar a PCA com nomes dos indivíduos
fviz_pca_ind(pca,
             label = "none", # ou "all" para mostrar nomes
             habillage = cutree(cluster, k = 3), # colorir por grupo do dendrograma
             addEllipses = TRUE,
             title = "PCA - RAPD")
```

### 6.1. PCA (Análise de Componentes Principais)

```{r, warning=FALSE}
# Plotagem usando factoextra
# PCA (Análise de Componentes Principais)
# Para visualizar agrupamentos dos indivíduos.
pca <- prcomp(matriz_binaria, scale. = TRUE)
fviz_pca_ind(pca, geom = "point", habillage = dados1$individuo, palette = "jco")

```

### 7. Agrupamento com k-means (alternativa ao dendrograma)

```{r}
set.seed(123)  # Para reprodutibilidade
km <- kmeans(matriz_binaria, centers = 3, nstart = 25)

# Visualizar os clusters na PCA
fviz_cluster(km, data = matriz_binaria,
             labelsize = 10,
             main = "K-means sobre dados RAPD")

```

### 8. Salvar gráficos

```{r}
ggsave("pca_rapd.png", width = 6, height = 5, dpi = 300)
```



## 2. Leitura dos dados SSR


```{r}
SSR <- read_excel("C:/Git/EstDocenciaUEM/AULA - PRATICA/SSR.xlsx", sheet = "SSR")  # substitua pelo caminho correto se necessário
```

### 2. Visualização dos dados SSR

```{r}
head(SSR)
```

```{r}
# Converter para formato genind (pacote adegenet/poppr)
# Supondo que a primeira coluna é o nome da amostra
dados_genind <- df2genind(SSR[,-1], ploidy=2, sep="/", ind.names=SSR[[1]])
```

### 4. Calcular matriz de distância (Nei)

```{r}
# Distância genética (ex: distância de Nei)
dist_matrix <- dist(dados_genind, method = "euclidean") 
```

### 5. Dendrograma com rótulos dos indivíduos

```{r}
hc2 <- hclust(dist_matrix, method = "ward.D2")
plot(hc2, main="Dendrograma de similaridade SSR", xlab="", sub="", cex=0.8)
```

```{r}
# Plotagem usando factoextra
fviz_dend(hc2,
          cex = 0.8,               # Tamanho da fonte
          k = 4,                   # Número de grupos (opcional)
          k_colors = c("#E41A1C", "#377EB8", "#4DAF4A", "#984EA3"),  # Cores para os grupos
          label_cols = "black",
          rect = TRUE,             # Mostrar retângulos nos grupos
          rect_fill = TRUE,
          rect_border = "jco",     # Cor das bordas
          main = "Dendrograma de similaridade SSR")
```
